<div class="form-container">
  <div class="form-card">
    <h1>‚ú® Crear Cuenta</h1>
    <p>√önete a nuestra comunidad</p>
    
    <form id="registerForm">
      <div class="form-row">
        <div class="form-group">
          <label for="first_name">Nombre</label>
          <input 
            type="text" 
            id="first_name" 
            name="first_name" 
            required 
            placeholder="Juan"
          >
        </div>

        <div class="form-group">
          <label for="last_name">Apellido</label>
          <input 
            type="text" 
            id="last_name" 
            name="last_name" 
            required 
            placeholder="P√©rez"
          >
        </div>
      </div>

      <div class="form-group">
        <label for="email">Correo Electr√≥nico</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          required 
          placeholder="tu@correo.com"
        >
      </div>

      <div class="form-group">
        <label for="age">Edad</label>
        <input 
          type="number" 
          id="age" 
          name="age" 
          required 
          min="18" 
          max="120"
          placeholder="25"
        >
      </div>

      <div class="form-group">
        <label for="password">Contrase√±a</label>
        <input 
          type="password" 
          id="password" 
          name="password" 
          required 
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
        >
      </div>

      <div id="errorMessage" class="alert alert-error" style="display: none;"></div>
      <div id="successMessage" class="alert alert-success" style="display: none;"></div>

      <button type="submit" class="btn-primary">Crear Cuenta</button>
    </form>

    <div class="form-link">
      <a href="/login">¬øYa tienes cuenta? Inicia sesi√≥n</a>
    </div>
  </div>
</div>

<script>
  console.log('üìù Vista de registro cargada');

  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');
    errorDiv.textContent = '';
    successDiv.textContent = '';
    
    const formData = {
      first_name: document.getElementById('first_name').value,
      last_name: document.getElementById('last_name').value,
      email: document.getElementById('email').value,
      age: parseInt(document.getElementById('age').value),
      password: document.getElementById('password').value
    };

    console.log('üì§ Enviando registro para:', formData.email);

    try {
      const response = await fetch('/api/sessions/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      console.log('üì• Respuesta recibida:', response.status);

      const data = await response.json();
      console.log('üì¶ Datos:', data);

      if (response.ok) {
        console.log('‚úì Registro exitoso');
        
        // Guardar token
        if (data.token) {
          try {
            localStorage.setItem('token', data.token);
            console.log('‚úì Token guardado en localStorage');
          } catch (storageError) {
            console.error('‚ùå Error guardando token:', storageError);
          }
        }
        
        successDiv.textContent = 'Registro exitoso. Redirigiendo...';
        setTimeout(() => {
          console.log('üîÑ Redirigiendo a login...');
          window.location.href = '/login';
        }, 1500);
      } else {
        console.error('‚ùå Error en registro:', data.message);
        errorDiv.textContent = data.message || 'Error al registrar usuario';
      }
    } catch (error) {
      console.error('‚ùå Error de conexi√≥n:', error);
      errorDiv.textContent = 'Error de conexi√≥n con el servidor';
    }
  });
</script>