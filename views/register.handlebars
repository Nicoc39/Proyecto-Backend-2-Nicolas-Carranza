<div class="container">
  <div class="form-container">
    <h1>Registro de Usuario</h1>
    
    <form id="registerForm">
      <div class="form-group">
        <label for="first_name">Nombre</label>
        <input 
          type="text" 
          id="first_name" 
          name="first_name" 
          required 
          placeholder="Juan"
        >
      </div>

      <div class="form-group">
        <label for="last_name">Apellido</label>
        <input 
          type="text" 
          id="last_name" 
          name="last_name" 
          required 
          placeholder="Pérez"
        >
      </div>

      <div class="form-group">
        <label for="email">Correo Electrónico</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          required 
          placeholder="correo@ejemplo.com"
        >
      </div>

      <div class="form-group">
        <label for="age">Edad</label>
        <input 
          type="number" 
          id="age" 
          name="age" 
          required 
          min="1" 
          max="120"
          placeholder="25"
        >
      </div>

      <div class="form-group">
        <label for="password">Contraseña</label>
        <input 
          type="password" 
          id="password" 
          name="password" 
          required 
          placeholder="********"
        >
      </div>

      <div id="errorMessage" class="error-message"></div>
      <div id="successMessage" class="success-message"></div>

      <button type="submit" class="btn-primary">Registrarse</button>
    </form>

    <p class="form-footer">
      ¿Ya tienes cuenta? <a href="/login">Inicia sesión aquí</a>
    </p>
  </div>
</div>

<script>
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');
    errorDiv.textContent = '';
    successDiv.textContent = '';
    
    const formData = {
      first_name: document.getElementById('first_name').value,
      last_name: document.getElementById('last_name').value,
      email: document.getElementById('email').value,
      age: parseInt(document.getElementById('age').value),
      password: document.getElementById('password').value
    };

    try {
      const response = await fetch('/api/sessions/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      console.log('Register Response:', {
        status: response.status,
        ok: response.ok,
        data: data
      });

      if (data.status === 'success' && data.token) {
        // Guardar token en localStorage
        localStorage.setItem('token', data.token);
        console.log('✓ Token guardado en localStorage');
        
        successDiv.textContent = 'Registro exitoso. Redirigiendo...';
        setTimeout(() => {
          window.location.href = data.redirect || '/products';
        }, 1000);
      } else {
        errorDiv.textContent = data.message || 'Error al registrar usuario';
        console.error('Register error:', data);
      }
    } catch (error) {
      errorDiv.textContent = 'Error de conexión';
      console.error('Error:', error);
    }
  });
</script>